<!-- Navigation -->
{% assign invert_nav = page.nav-style == "invert" or page.header-style == "text" %}
<nav class="navbar navbar-default navbar-custom navbar-fixed-top{% if invert_nav %} invert{% endif %}">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header page-scroll">
      <button type="button" class="navbar-toggle" aria-label="切换导航">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="{{ site.baseurl }}/">{{ site.title }}</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div id="huxblog_navbar">
      <div class="navbar-collapse">
        <ul class="nav navbar-nav navbar-right">
          {%- comment -%} 固定主菜单 {%- endcomment -%}
          <li class="{% if page.url == '/' or page.url == site.baseurl or page.permalink == '/' %}active{% endif %}">
            <a href="{{ site.baseurl }}/">首页</a>
          </li>
          <li class="{% if page.url contains '/archive' %}active{% endif %}">
            <a href="{{ site.baseurl }}/archive.html">归档</a>
          </li>
          <li class="{% if page.url contains '/about' %}active{% endif %}">
            <a href="{{ site.baseurl }}/about.html">关于</a>
          </li>
          <li>
            <a href="{{ site.baseurl }}/meaning-test/">意义测试</a>
          </li>

          {%- comment -%}
          动态追加其它页面：
          - 在任意页面 Front-Matter 设置 hide-in-nav: true 可隐藏
          - 避免与上面固定项重复（通过 url 过滤）
          {%- endcomment -%}
          {% assign fixed_urls = site.baseurl | append: '/,/archive.html,/about.html,/meaning-test/' | split: ',' %}
          {% for p in site.pages %}
            {% if p.title and p.hide-in-nav != true %}
              {% assign p_url = p.url | prepend: site.baseurl %}
              {% assign dup = false %}
              {% for fu in fixed_urls %}
                {% if p_url == fu %}{% assign dup = true %}{% break %}{% endif %}
              {% endfor %}
              {% if dup == false %}
                <li class="{% if page.url == p.url %}active{% endif %}">
                  <a href="{{ p.url | prepend: site.baseurl }}">{{ p.title }}</a>
                </li>
              {% endif %}
            {% endif %}
          {% endfor %}

          {%- comment -%} 搜索图标（主题已有对应行为） {%- endcomment -%}
          <li class="search-icon">
            <a href="javascript:void(0)" aria-label="搜索">
              <i class="fa fa-search"></i>
            </a>
          </li>
        </ul>
      </div>
    </div>
    <!-- /.navbar-collapse -->
  </div>
  <!-- /.container -->
</nav>

<script>
  // 自定义导航开合（保持主题原逻辑）
  var $toggle = document.querySelector('.navbar-toggle');
  var $navbar = document.querySelector('#huxblog_navbar');
  var $collapse = document.querySelector('.navbar-collapse');

  var __HuxNav__ = {
    close: function () {
      $navbar.className = " ";
      setTimeout(function () {
        if ($navbar.className.indexOf('in') < 0) {
          $collapse.style.height = "0px";
        }
      }, 400);
    },
    open: function () {
      $collapse.style.height = "auto";
      if ($navbar.className.indexOf('in') < 0) {
        $navbar.className += " in";
      }
    }
  };

  $toggle.addEventListener('click', function () {
    if ($navbar.className.indexOf('in') > 0) __HuxNav__.close();
    else __HuxNav__.open();
  });

  // 点击空白处关闭，避免与 FastClick 冲突
  document.addEventListener('click', function (e) {
    if (e.target === $toggle) return;
    if (e.target.className === 'icon-bar') return;
    __HuxNav__.close();
  });
</script>
