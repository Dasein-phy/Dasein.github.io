---
layout: page
description: "「离开世界之前 一切都是过程」"
---

<div class="dz-layout post-list">
  <!-- 左侧：文章卡片流 -->
  <div class="post-col">
    {% for post in paginator.posts %}
    <article class="card post-card">
      <a class="post-link" href="{{ post.url | prepend: site.baseurl }}">
        <h2 class="post-title">{{ post.title }}</h2>
        {% if post.subtitle %}
          <h3 class="post-subtitle">{{ post.subtitle }}</h3>
        {% endif %}
        <p class="excerpt">
          {% if post.lang == 'en' %}
            {{ post.content | strip_html | truncate: 300 }}
          {% else %}
            {{ post.content | strip_html | truncate: 200 }}
          {% endif %}
        </p>
      </a>
      <div class="post-meta">
        <span>{{ post.date | date: "%Y-%m-%d" }}</span>
        {% if post.tags and post.tags.size > 0 %}
          <span class="dot">•</span>
          <span class="tags">
            {% for t in post.tags limit:3 %}
              <span class="tag">{{ t }}</span>
            {% endfor %}
          </span>
        {% endif %}
      </div>
    </article>
    {% endfor %}

    <!-- 翻页 -->
    {% if paginator.total_pages > 1 %}
    <ul class="pager pager-clean">
      {% if paginator.previous_page %}
      <li class="previous">
        <a class="btn btn-pager" href="{{ paginator.previous_page_path | prepend: site.baseurl | replace: '//', '/' }}">&larr; 上一页</a>
      </li>
      {% endif %}
      {% if paginator.next_page %}
      <li class="next">
        <a class="btn btn-pager" href="{{ paginator.next_page_path | prepend: site.baseurl | replace: '//', '/' }}">下一页 &rarr;</a>
      </li>
      {% endif %}
    </ul>
    {% endif %}
  </div>

    <!-- 时间目录（最新在上） -->
    <section class="card directory-card">
      <h6 class="card-title">最新文章</h6>
      <div class="dir-list">
        {% assign _sorted = site.posts | sort: 'date' | reverse %}
        {% for p in _sorted limit: 40 %}
        <div class="dir-item">
          <a href="{{ p.url | prepend: site.baseurl }}" title="{{ p.title }}">{{ p.title }}</a>
          <span class="dir-date">{{ p.date | date: "%m-%d" }}</span>
        </div>
        {% endfor %}
      </div>
    </section>
  </aside>
</div>

<script>
(function(){
  var rail = document.getElementById('bookmark-rail');
  if(!rail) return;

  var ul = rail.querySelector('.bm-ul');
  var items = ul.querySelectorAll('.bm-item');

  var H = 56;                 // 每根卡高度(含间距)，需与 CSS 一致
  var visible = 7;            // 一屏显示 7 根（上下“半隐”由裁剪产生）
  var idx = 0;
  var lock = false;

  // —— 如果文章很少（≤5），关闭“半隐”和滚动 —— //
  if(items.length <= 5){
    rail.style.height = 'auto';
    rail.style.paddingTop = '0';
    rail.style.paddingBottom = '0';
    rail.style.overflow = 'visible';
  }

  function maxIdx(){
    if(items.length <= visible) return 0;
    return Math.max(0, items.length - visible);
  }

  function update(){
    ul.style.transform = 'translateY(' + (-idx * H) + 'px)';
  }
  update();

  function scrollBy(dir){
    var m = maxIdx();
    if(m === 0) return;            // 少量文章：禁用滚动
    idx = Math.min(m, Math.max(0, idx + dir));
    update();
  }

  rail.addEventListener('wheel', function(e){
    var m = maxIdx();
    if(m === 0) return;            // 少量文章：直接透传滚轮
    e.preventDefault();
    if(lock) return;
    lock = true;
    var dir = (e.deltaY > 0) ? 1 : -1;
    scrollBy(dir);
    setTimeout(function(){ lock = false; }, 160);
  }, { passive:false });

  // 键盘 ↑↓ 也可切换（仅当可滚动时）
  window.addEventListener('keydown', function(e){
    var m = maxIdx();
    if(m === 0) return;
    if(e.key === 'ArrowDown'){ scrollBy(1); }
    if(e.key === 'ArrowUp'){ scrollBy(-1); }
  });
})();
</script>

